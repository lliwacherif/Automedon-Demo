import{c as S,d as F,a3 as H,a0 as U,r as m,V as $,U as b,a as f,e as l,o as i,g as t,C as R,E as z,O,k as n,h as a,$ as P,f as _,j as A,v as I,H as L,F as M,m as V}from"./index-CUyxnoW2.js";import{M as Y}from"./useMaintenanceRecords-CQ0w2c_K.js";import{f as w}from"./date-BpD5EXL9.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=S("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),J={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},K={class:"mb-6 flex justify-between items-center"},Q={class:"flex items-center space-x-4 bg-white p-3 rounded-lg shadow-sm border border-gray-200"},W={class:"flex items-center space-x-2"},X={class:"flex items-center space-x-2"},Z={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-8"},tt={class:"px-4 py-5 sm:px-6 flex justify-between items-start"},et={class:"text-2xl font-bold leading-6 text-gray-900 flex items-center gap-2"},st={class:"mt-1 text-sm text-gray-500 flex items-center gap-2"},at={class:"bg-gray-100 px-2 py-0.5 rounded text-gray-700 font-mono"},ot={key:0,class:"h-16 w-24 flex-shrink-0"},rt=["src"],nt={class:"border-t border-gray-200 px-4 py-5 sm:px-6"},lt={class:"flex items-center justify-end"},it={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},dt={class:"bg-white shadow overflow-hidden sm:rounded-lg"},ct={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},ut={class:"text-lg leading-6 font-medium text-gray-900"},mt={class:"text-sm font-bold text-green-600"},xt={class:"overflow-x-auto"},pt={class:"min-w-full divide-y divide-gray-300"},ft={class:"bg-gray-50"},_t={scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},vt={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},yt={scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"},gt={class:"divide-y divide-gray-200 bg-white"},ht={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},bt={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},wt={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},kt={key:0},Dt={colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"},Ct={class:"bg-white shadow overflow-hidden sm:rounded-lg"},Et={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},Nt={class:"text-sm font-bold text-red-600"},Tt={class:"overflow-x-auto"},jt={class:"min-w-full divide-y divide-gray-300"},Rt={class:"divide-y divide-gray-200 bg-white"},At={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},It={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},Lt={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},Mt={key:0},Vt={key:1,class:"flex justify-center items-center h-64"},Ut=F({__name:"Show",setup(qt){const{t:d}=H(),v=U().params.id,r=m(null),k=m([]),D=m([]),y=m(!0),c=m(""),u=m("");$(async()=>{await q()});async function q(){y.value=!0;try{const{data:o,error:e}=await b.from("cars").select("*").eq("id",v).single();if(e)throw e;r.value=o;const{data:s,error:p}=await b.from("reservations").select("*").eq("car_id",v).order("start_date",{ascending:!1});if(p)throw p;k.value=s||[];const{data:B,error:j}=await b.from("maintenance_records").select("*").eq("car_id",v).order("maintenance_date",{ascending:!1});if(j)throw j;D.value=B||[]}catch(o){console.error("Error fetching car history:",o)}finally{y.value=!1}}const x=o=>new Intl.NumberFormat("fr-TN",{style:"currency",currency:"TND"}).format(o),C=o=>{if(!c.value&&!u.value)return!0;const e=new Date(o),s=c.value?new Date(c.value):null,p=u.value?new Date(u.value):null;return!(s&&e<s||p&&e>p)},g=f(()=>k.value.filter(o=>C(o.start_date))),h=f(()=>D.value.filter(o=>C(o.maintenance_date))),E=f(()=>g.value.reduce((o,e)=>o+(e.total_price||0),0)),N=f(()=>h.value.reduce((o,e)=>o+(e.cost||0),0)),T=f(()=>E.value-N.value);return(o,e)=>!y.value&&r.value?(i(),l("div",J,[t("div",K,[R(n(P),{to:"/admin/history",class:"flex items-center text-sm text-gray-500 hover:text-gray-700"},{default:z(()=>[R(n(G),{class:"w-4 h-4 mr-1"}),O(" "+a(n(d)("admin.history.back_to_list")),1)]),_:1}),t("div",Q,[t("div",W,[e[3]||(e[3]=t("label",{class:"text-sm font-medium text-gray-700"},"Du:",-1)),A(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[I,c.value]])]),t("div",X,[e[4]||(e[4]=t("label",{class:"text-sm font-medium text-gray-700"},"Au:",-1)),A(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[I,u.value]])]),c.value||u.value?(i(),l("button",{key:0,onClick:e[2]||(e[2]=s=>{c.value="",u.value=""}),class:"text-xs text-indigo-600 hover:text-indigo-800 font-medium"}," Réinitialiser ")):_("",!0)])]),t("div",Z,[t("div",tt,[t("div",null,[t("h3",et,a(r.value.brand)+" "+a(r.value.model),1),t("p",st,[t("span",at,a(r.value.license_plate),1),t("span",{class:L({"text-green-600":r.value.status==="disponible","text-blue-600":r.value.status==="loue","text-red-600":r.value.status==="maintenance"})}," ● "+a(r.value.status?n(d)(`admin.fleet.${r.value.status}`):r.value.status),3)])]),r.value.image_url?(i(),l("div",ot,[t("img",{src:r.value.image_url,alt:"",class:"h-full w-full object-cover rounded-md"},null,8,rt)])):_("",!0)]),t("div",nt,[t("div",lt,[t("div",{class:L(["text-xl font-bold",T.value>=0?"text-green-600":"text-red-600"])}," Revenu Net: "+a(x(T.value)),3)])])]),t("div",it,[t("div",dt,[t("div",ct,[t("h3",ut,a(n(d)("admin.history.reservations_history")),1),t("div",mt," Total: "+a(x(E.value)),1)]),t("div",xt,[t("table",pt,[t("thead",ft,[t("tr",null,[t("th",_t,a(n(d)("admin.reservations.client")),1),t("th",vt,a(n(d)("admin.reservations.dates")),1),t("th",yt,a(n(d)("admin.reservations.total_price")),1)])]),t("tbody",gt,[(i(!0),l(M,null,V(g.value,s=>(i(),l("tr",{key:s.id},[t("td",ht,a(s.client_name),1),t("td",bt,a(n(w)(s.start_date))+" - "+a(n(w)(s.end_date)),1),t("td",wt,a(x(s.total_price)),1)]))),128)),g.value.length===0?(i(),l("tr",kt,[t("td",Dt,a(n(d)("admin.history.no_reservations")),1)])):_("",!0)])])])]),t("div",Ct,[t("div",Et,[e[5]||(e[5]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"}," Historique des Coûts ",-1)),t("div",Nt," Total: "+a(x(N.value)),1)]),t("div",Tt,[t("table",jt,[e[7]||(e[7]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"}," Type "),t("th",{scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Date "),t("th",{scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"}," Coût ")])],-1)),t("tbody",Rt,[(i(!0),l(M,null,V(h.value,s=>(i(),l("tr",{key:s.id},[t("td",At,a(n(Y)[s.maintenance_type]||s.maintenance_type),1),t("td",It,a(n(w)(s.maintenance_date)),1),t("td",Lt,a(x(s.cost)),1)]))),128)),h.value.length===0?(i(),l("tr",Mt,[...e[6]||(e[6]=[t("td",{colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"}," Aucun entretien enregistré. ",-1)])])):_("",!0)])])])])])])):(i(),l("div",Vt,[...e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"},null,-1)])]))}});export{Ut as default};
