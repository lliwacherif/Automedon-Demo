import{r as l,a as h,U as c}from"./index-BQIPyYnB.js";const _={OIL_CHANGE:"Vidange",BRAKE_SERVICE:"Freins",REPAIR:"RÃ©paration",ROUTINE_CHECK:"Visite Technique",LAVAGE:"Lavage",ASSURANCE:"Assurance",VIGNETTE:"Vignette",LEASING:"Leasing (Cambiale)"};function y(){const i=l([]),n=l(!1),t=l(null),u=h(()=>i.value.reduce((r,a)=>r+Number(a.cost),0));async function o(r){n.value=!0,t.value=null;try{const{data:a,error:e}=await c.from("maintenance_records").select("*").eq("car_id",r).order("maintenance_date",{ascending:!1});if(e)throw e;i.value=a||[]}catch(a){t.value=a.message,console.error("Error fetching maintenance records:",a)}finally{n.value=!1}}async function d(r){n.value=!0,t.value=null;try{const{data:a,error:e}=await c.from("maintenance_records").select("*").eq("id",r).single();if(e)throw e;return a}catch(a){return t.value=a.message,console.error("Error fetching maintenance record:",a),null}finally{n.value=!1}}async function f(r){n.value=!0,t.value=null;try{const{data:a,error:e}=await c.from("maintenance_records").insert([r]).select().single();if(e)throw e;return r.car_id&&await o(r.car_id),a}catch(a){throw t.value=a.message,console.error("Error creating maintenance record:",a),a}finally{n.value=!1}}async function m(r,a){n.value=!0,t.value=null;try{const{data:e,error:s}=await c.from("maintenance_records").update(a).eq("id",r).select().single();if(s)throw s;return e&&e.car_id&&await o(e.car_id),e}catch(e){throw t.value=e.message,console.error("Error updating maintenance record:",e),e}finally{n.value=!1}}async function E(r,a){n.value=!0,t.value=null;try{const{error:e}=await c.from("maintenance_records").delete().eq("id",r);if(e)throw e;await o(a)}catch(e){throw t.value=e.message,console.error("Error deleting maintenance record:",e),e}finally{n.value=!1}}async function v(r){try{const{data:a,error:e}=await c.from("maintenance_records").select("cost").eq("car_id",r);if(e)throw e;return(a||[]).reduce((s,g)=>s+Number(g.cost),0)}catch(a){return console.error("Error calculating total maintenance cost:",a),0}}return{maintenanceRecords:i,loading:n,error:t,totalMaintenanceCost:u,fetchMaintenanceRecords:o,getMaintenanceRecord:d,createMaintenanceRecord:f,updateMaintenanceRecord:m,deleteMaintenanceRecord:E,calculateTotalMaintenanceCost:v}}export{_ as M,y as u};
