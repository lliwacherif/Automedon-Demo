import{c as A,d as I,a2 as M,$ as R,r as p,V,U as h,a as y,e as l,o as i,g as t,C,E as q,O as B,k as r,h as e,Z as F,f as g,H as E,F as T,m as D}from"./index-BDZ5CRY0.js";import{M as H}from"./useMaintenanceRecords-FgaKSdZO.js";import{f}from"./date-BpD5EXL9.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=A("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),z={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},$={class:"mb-6"},O={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-8"},P={class:"px-4 py-5 sm:px-6 flex justify-between items-start"},U={class:"text-2xl font-bold leading-6 text-gray-900 flex items-center gap-2"},Y={class:"mt-1 text-sm text-gray-500 flex items-center gap-2"},Z={class:"bg-gray-100 px-2 py-0.5 rounded text-gray-700 font-mono"},G={key:0,class:"h-16 w-24 flex-shrink-0"},J=["src"],K={class:"border-t border-gray-200 px-4 py-5 sm:px-6"},Q={class:"flex items-center justify-end"},W={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},X={class:"bg-white shadow overflow-hidden sm:rounded-lg"},tt={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},et={class:"text-lg leading-6 font-medium text-gray-900"},st={class:"text-sm font-bold text-green-600"},at={class:"overflow-x-auto"},ot={class:"min-w-full divide-y divide-gray-300"},rt={class:"bg-gray-50"},nt={scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},lt={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},it={scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"},dt={class:"divide-y divide-gray-200 bg-white"},ct={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},mt={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},ut={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},pt={key:0},xt={colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"},_t={class:"bg-white shadow overflow-hidden sm:rounded-lg"},ht={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},yt={class:"text-sm font-bold text-red-600"},gt={class:"overflow-x-auto"},ft={class:"min-w-full divide-y divide-gray-300"},vt={class:"divide-y divide-gray-200 bg-white"},wt={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},bt={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},kt={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},Nt={key:0},Ct={key:1,class:"flex justify-center items-center h-64"},At=I({__name:"Show",setup(Et){const{t:d}=M(),x=R().params.id,a=p(null),m=p([]),u=p([]),_=p(!0);V(async()=>{await L()});async function L(){_.value=!0;try{const{data:n,error:s}=await h.from("cars").select("*").eq("id",x).single();if(s)throw s;a.value=n;const{data:o,error:k}=await h.from("reservations").select("*").eq("car_id",x).order("start_date",{ascending:!1});if(k)throw k;m.value=o||[];const{data:j,error:N}=await h.from("maintenance_records").select("*").eq("car_id",x).order("maintenance_date",{ascending:!1});if(N)throw N;u.value=j||[]}catch(n){console.error("Error fetching car history:",n)}finally{_.value=!1}}const c=n=>new Intl.NumberFormat("fr-TN",{style:"currency",currency:"TND"}).format(n),v=y(()=>m.value.reduce((n,s)=>n+(s.total_price||0),0)),w=y(()=>u.value.reduce((n,s)=>n+(s.cost||0),0)),b=y(()=>v.value-w.value);return(n,s)=>!_.value&&a.value?(i(),l("div",z,[t("div",$,[C(r(F),{to:"/admin/history",class:"flex items-center text-sm text-gray-500 hover:text-gray-700"},{default:q(()=>[C(r(S),{class:"w-4 h-4 mr-1"}),B(" "+e(r(d)("admin.history.back_to_list")),1)]),_:1})]),t("div",O,[t("div",P,[t("div",null,[t("h3",U,e(a.value.brand)+" "+e(a.value.model),1),t("p",Y,[t("span",Z,e(a.value.license_plate),1),t("span",{class:E({"text-green-600":a.value.status==="disponible","text-blue-600":a.value.status==="loue","text-red-600":a.value.status==="maintenance"})}," ● "+e(a.value.status?r(d)(`admin.fleet.${a.value.status}`):a.value.status),3)])]),a.value.image_url?(i(),l("div",G,[t("img",{src:a.value.image_url,alt:"",class:"h-full w-full object-cover rounded-md"},null,8,J)])):g("",!0)]),t("div",K,[t("div",Q,[t("div",{class:E(["text-xl font-bold",b.value>=0?"text-green-600":"text-red-600"])}," Revenu Net: "+e(c(b.value)),3)])])]),t("div",W,[t("div",X,[t("div",tt,[t("h3",et,e(r(d)("admin.history.reservations_history")),1),t("div",st," Total: "+e(c(v.value)),1)]),t("div",at,[t("table",ot,[t("thead",rt,[t("tr",null,[t("th",nt,e(r(d)("admin.reservations.client")),1),t("th",lt,e(r(d)("admin.reservations.dates")),1),t("th",it,e(r(d)("admin.reservations.total_price")),1)])]),t("tbody",dt,[(i(!0),l(T,null,D(m.value,o=>(i(),l("tr",{key:o.id},[t("td",ct,e(o.client_name),1),t("td",mt,e(r(f)(o.start_date))+" - "+e(r(f)(o.end_date)),1),t("td",ut,e(c(o.total_price)),1)]))),128)),m.value.length===0?(i(),l("tr",pt,[t("td",xt,e(r(d)("admin.history.no_reservations")),1)])):g("",!0)])])])]),t("div",_t,[t("div",ht,[s[0]||(s[0]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"}," Historique des Coûts ",-1)),t("div",yt," Total: "+e(c(w.value)),1)]),t("div",gt,[t("table",ft,[s[2]||(s[2]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"}," Type "),t("th",{scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Date "),t("th",{scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"}," Coût ")])],-1)),t("tbody",vt,[(i(!0),l(T,null,D(u.value,o=>(i(),l("tr",{key:o.id},[t("td",wt,e(r(H)[o.maintenance_type]||o.maintenance_type),1),t("td",bt,e(r(f)(o.maintenance_date)),1),t("td",kt,e(c(o.cost)),1)]))),128)),u.value.length===0?(i(),l("tr",Nt,[...s[1]||(s[1]=[t("td",{colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"}," Aucun entretien enregistré. ",-1)])])):g("",!0)])])])])])])):(i(),l("div",Ct,[...s[3]||(s[3]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"},null,-1)])]))}});export{At as default};
