import{d as R,r as d,a as j,V as S,a0 as P,e as r,o as u,g as e,h as o,f as p,j as m,l as w,F as T,m as D,v as _,O as y,a1 as I,C as G,E as z,a2 as A,k,i as J,W}from"./index-ikd10qBV.js";import{u as H}from"./useCars-BmzaelWU.js";import{u as O}from"./useFileUpload-32b6F5Gz.js";const K={class:"p-6"},Q={class:"text-2xl font-semibold text-gray-900 mb-6"},X={key:0,class:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded"},Y={class:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2"},Z={class:"block text-sm font-medium text-gray-700"},ee={value:"",disabled:""},te=["value"],ae={class:"block text-sm font-medium text-gray-700"},se={class:"sm:col-span-2"},le={class:"block text-sm font-medium text-gray-700 mb-2"},oe={class:"flex items-center gap-2"},ne={key:0,class:"ml-4 text-sm text-gray-500"},ie={class:"font-mono font-bold"},re={class:"mt-1 text-sm text-gray-500"},ue={class:"sm:col-span-2"},de={class:"block text-sm font-medium text-gray-700 mb-2"},me={class:"mb-3 flex items-center"},ce=["disabled"],fe={value:"disponible"},ge={value:"loue"},pe={value:"maintenance"},ve={key:0,class:"mt-1 text-xs text-indigo-600"},be={key:1,class:"mt-1 space-y-1"},xe={key:0,class:"text-xs text-gray-500"},_e={class:"sm:col-span-2"},ye={key:0,class:"mb-4 relative inline-block"},he=["src"],we={class:"flex justify-end space-x-3"},ke=["disabled"],qe=R({__name:"Edit",setup($e){const{fetchCarById:$,createCar:U,updateCar:C}=H(),{uploadFile:N,uploading:h}=O(),v=P(),q=W(),b=d(!1),c=d(!1),i=d(""),g=d(null),f=d(""),V=["Renault","Dacia","Skoda","Hyundai"],a=d({brand:"",model:"",plate_prefix:"",plate_suffix:"",status:"disponible",image_url:"",auto_manage_status:!0}),x=j(()=>a.value.plate_prefix&&a.value.plate_suffix?`${a.value.plate_prefix}TN${a.value.plate_suffix}`:"");S(async()=>{if(v.params.id){b.value=!0;const s=await $(Number(v.params.id));if(s){const t=s.plate_number.match(/^(\d+)TN(\d+)$/),n=t?t[1]:"",l=t?t[2]:"";a.value.brand=s.brand,a.value.model=s.model,a.value.plate_prefix=n,a.value.plate_suffix=l,a.value.status=s.status,a.value.image_url=s.image_url||"",a.value.auto_manage_status=s.auto_manage_status!==!1,f.value=s.image_url||""}}});function L(s){const n=s.target.files?.[0];if(n){if(!n.type.startsWith("image/")){i.value="Veuillez sÃ©lectionner une image valide";return}if(n.size>5*1024*1024){i.value="L'image ne doit pas dÃ©passer 5 MB";return}g.value=n;const l=new FileReader;l.onload=E=>{f.value=E.target?.result},l.readAsDataURL(n),i.value=""}}function F(){g.value=null,f.value="",a.value.image_url="";const s=document.getElementById("car-image");s&&(s.value="")}function M(s,t){return/^\d{1,3}$/.test(s)&&/^\d{1,4}$/.test(t)}async function B(){if(c.value=!0,i.value="",!M(a.value.plate_prefix,a.value.plate_suffix)){i.value="Format de plaque invalide. Utilisez uniquement des chiffres (ex: 245 TN 4521)",c.value=!1;return}try{let s=a.value.image_url;if(g.value){const n=await N(g.value,"car-images","cars");if(n)s=n;else throw console.error("Upload returned null"),new Error("Ã‰chec du tÃ©lÃ©chargement de l'image (URL manquante)")}const t={brand:a.value.brand,model:a.value.model,plate_number:x.value,status:a.value.status,image_url:s||void 0,auto_manage_status:a.value.auto_manage_status};b.value?await C(Number(v.params.id),t):await U(t),q.push("/admin/cars")}catch(s){console.error("Error saving car:",s),i.value=s.message||"Une erreur est survenue lors de l'enregistrement"}finally{c.value=!1}}return(s,t)=>{const n=A("RouterLink");return u(),r("div",K,[e("h1",Q,o(b.value?s.$t("admin.fleet.edit_car"):s.$t("admin.fleet.create_car")),1),e("form",{onSubmit:J(B,["prevent"]),class:"bg-white shadow sm:rounded-lg p-6 space-y-6"},[i.value?(u(),r("div",X,o(i.value),1)):p("",!0),e("div",Y,[e("div",null,[e("label",Z,o(s.$t("admin.fleet.brand")),1),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.brand=l),required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[e("option",ee,o(s.$t("admin.fleet.select_brand")),1),(u(),r(T,null,D(V,l=>e("option",{key:l,value:l},o(l),9,te)),64))],512),[[w,a.value.brand]])]),e("div",null,[e("label",ae,o(s.$t("admin.fleet.model")),1),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.model=l),type:"text",required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[_,a.value.model]])]),e("div",se,[e("label",le,o(s.$t("admin.fleet.plate_number")),1),e("div",oe,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.plate_prefix=l),type:"text",required:"",placeholder:"245",maxlength:"3",pattern:"\\d{1,3}",class:"block w-24 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[_,a.value.plate_prefix]]),t[7]||(t[7]=e("span",{class:"text-lg font-bold text-gray-700"},"TN",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.plate_suffix=l),type:"text",required:"",placeholder:"4521",maxlength:"4",pattern:"\\d{1,4}",class:"block w-28 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[_,a.value.plate_suffix]]),x.value?(u(),r("span",ne,[t[6]||(t[6]=y(" AperÃ§u: ",-1)),e("span",ie,o(x.value),1)])):p("",!0)]),e("p",re,o(s.$t("admin.fleet.plate_format")),1)]),e("div",ue,[e("label",de,o(s.$t("admin.fleet.status")),1),e("div",me,[m(e("input",{id:"auto-manage-toggle","onUpdate:modelValue":t[4]||(t[4]=l=>a.value.auto_manage_status=l),type:"checkbox",class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[I,a.value.auto_manage_status]]),t[8]||(t[8]=e("label",{for:"auto-manage-toggle",class:"ml-2 block text-sm text-gray-700"},[y(" Gestion automatique du statut "),e("span",{class:"text-xs text-gray-500 block"}," Le statut sera automatiquement mis Ã  jour selon les rÃ©servations ")],-1))]),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.status=l),disabled:a.value.auto_manage_status||a.value.status!=="maintenance",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"},[e("option",fe,o(s.$t("admin.fleet.disponible")),1),e("option",ge,o(s.$t("admin.fleet.loue")),1),e("option",pe,o(s.$t("admin.fleet.maintenance")),1)],8,ce),[[w,a.value.status]]),a.value.auto_manage_status?(u(),r("p",ve," â„¹ï¸ Le statut sera automatiquement dÃ©fini selon les rÃ©servations actives ")):(u(),r("div",be,[t[9]||(t[9]=e("p",{class:"text-xs text-amber-600"}," âš ï¸ Le statut est contrÃ´lÃ© manuellement. ",-1)),a.value.status!=="maintenance"?(u(),r("p",xe," ðŸ”’ Le statut ne peut Ãªtre modifiÃ© manuellement que si le vÃ©hicule est en maintenance. ")):p("",!0)]))]),e("div",_e,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Image de la voiture (optionnel) ",-1)),f.value?(u(),r("div",ye,[e("img",{src:f.value,alt:"AperÃ§u",class:"h-40 w-auto rounded-lg shadow-md object-cover"},null,8,he),e("button",{type:"button",onClick:F,class:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500"},[...t[10]||(t[10]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):p("",!0),e("input",{id:"car-image",type:"file",accept:"image/*",onChange:L,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),t[12]||(t[12]=e("p",{class:"mt-1 text-sm text-gray-500"}," PNG, JPG, JPEG jusqu'Ã  5MB ",-1))])]),e("div",we,[G(n,{to:"/admin/cars",class:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:z(()=>[y(o(s.$t("admin.fleet.cancel")),1)]),_:1}),e("button",{type:"submit",disabled:c.value||k(h),class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"},o(c.value||k(h)?"Chargement...":s.$t("admin.fleet.save")),9,ke)])],32)])}}});export{qe as default};
