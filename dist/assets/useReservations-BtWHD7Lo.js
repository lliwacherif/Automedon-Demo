import{r as f,U as o}from"./index-DhycbAzN.js";function k(){const v=f([]),s=f(!1),l=f(null),y=f(0),d=t=>{const e={...t};return t.car&&(e.car={...t.car,plate_number:t.car.license_plate}),e};async function h(t=1,e="",a="all"){s.value=!0,l.value=null;try{let r=o.from("reservations").select("*, car:cars(*)",{count:"exact"});e&&(r=r.or(`reservation_number.ilike.%${e}%,client_name.ilike.%${e}%,client_cin.ilike.%${e}%`)),a&&a!=="all"&&(r=r.eq("status",a));const n=(t-1)*10,c=n+9,{data:i,count:m,error:u}=await r.range(n,c).order("created_at",{ascending:!1});if(u)throw u;v.value=(i||[]).map(d),y.value=m||0}catch(r){l.value=r.message}finally{s.value=!1}}async function p(t,e=1,a="all"){s.value=!0,l.value=null;try{let r=o.from("reservations").select("*, car:cars(*)",{count:"exact"}).eq("user_id",t);a&&a!=="all"&&(r=r.eq("status",a));const n=(e-1)*10,c=n+9,{data:i,count:m,error:u}=await r.range(n,c).order("created_at",{ascending:!1});if(u)throw u;v.value=(i||[]).map(d),y.value=m||0}catch(r){l.value=r.message}finally{s.value=!1}}async function w(t){s.value=!0;try{const{data:e,error:a}=await o.from("reservations").select("*, car:cars(*)").eq("id",t).single();if(a)throw a;return d(e)}catch(e){return l.value=e.message,null}finally{s.value=!1}}async function g(t){s.value=!0;try{const{data:e,error:a}=await o.from("reservations").insert(t).select();if(a)throw a;return e?.[0]||null}catch(e){throw l.value=e.message,e}finally{s.value=!1}}async function q(t,e){s.value=!0;try{const{data:a,error:r}=await o.from("reservations").update(e).eq("id",t).select();if(r)throw r;return a?.[0]||null}catch(a){throw l.value=a.message,a}finally{s.value=!1}}async function _(t){s.value=!0;try{const{error:e}=await o.from("reservations").delete().eq("id",t);if(e)throw e}catch(e){throw l.value=e.message,e}finally{s.value=!1}}async function b(t,e,a,r){s.value=!0;try{let n=o.from("reservations").select("id").eq("car_id",t).in("status",["confirmed","active"]).lt("start_date",a).gt("end_date",e);r&&(n=n.neq("id",r));const{data:c,error:i}=await n;if(i)throw i;return c&&c.length===0}catch(n){return console.error("Availability check failed:",n),!1}finally{s.value=!1}}return{reservations:v,loading:s,error:l,total:y,fetchReservations:h,fetchUserReservations:p,getReservation:w,createReservation:g,updateReservation:q,deleteReservation:_,checkAvailability:b}}export{k as u};
