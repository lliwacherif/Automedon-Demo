import{c as G,d as J,a3 as K,a0 as Q,r as v,V as W,U as C,a as g,e as i,o as d,g as t,C as F,E as X,O as Z,k as n,h as o,$ as tt,f as k,j as H,v as U,H as $,F as z,m as P}from"./index-BLfBT3CA.js";import{M as et}from"./useMaintenanceRecords-DKzhxvyx.js";import{f as N}from"./date-BpD5EXL9.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=G("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),at={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ot={class:"mb-6 flex justify-between items-center"},rt={class:"flex items-center space-x-4 bg-white p-3 rounded-lg shadow-sm border border-gray-200"},nt={class:"flex items-center space-x-2"},lt={class:"flex items-center space-x-2"},it={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-8"},dt={class:"px-4 py-5 sm:px-6 flex justify-between items-start"},ct={class:"text-2xl font-bold leading-6 text-gray-900 flex items-center gap-2"},ut={class:"mt-1 text-sm text-gray-500 flex items-center gap-2"},mt={class:"bg-gray-100 px-2 py-0.5 rounded text-gray-700 font-mono"},xt={key:0,class:"h-16 w-24 flex-shrink-0"},pt=["src"],ft={class:"border-t border-gray-200 px-4 py-5 sm:px-6"},vt={class:"flex items-center justify-end"},_t={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},yt={class:"bg-white shadow overflow-hidden sm:rounded-lg"},gt={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},ht={class:"text-lg leading-6 font-medium text-gray-900"},bt={class:"text-sm font-bold text-green-600"},wt={class:"overflow-x-auto"},kt={class:"min-w-full divide-y divide-gray-300"},Dt={class:"bg-gray-50"},Et={scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},Tt={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},Ct={scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"},Nt={class:"divide-y divide-gray-200 bg-white"},Mt={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},Rt={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},jt={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},St={key:0},At={colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"},Lt={class:"bg-white shadow overflow-hidden sm:rounded-lg"},Vt={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex justify-between items-center"},It={class:"text-sm font-bold text-red-600"},qt={class:"overflow-x-auto"},Bt={class:"min-w-full divide-y divide-gray-300"},Ft={class:"divide-y divide-gray-200 bg-white"},Ht={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},Ut={class:"whitespace-nowrap px-3 py-4 text-sm text-gray-500"},$t={class:"whitespace-nowrap px-3 py-4 text-right text-sm text-gray-900 font-medium"},zt={key:0},Pt={key:1,class:"flex justify-center items-center h-64"},Qt=J({__name:"Show",setup(Ot){const{t:p}=K(),D=Q().params.id,r=v(null),M=v([]),R=v([]),E=v(!0),c=v(""),u=v("");W(async()=>{await O()});async function O(){E.value=!0;try{const{data:s,error:e}=await C.from("cars").select("*").eq("id",D).single();if(e)throw e;r.value=s;const{data:a,error:m}=await C.from("reservations").select("*").eq("car_id",D).order("start_date",{ascending:!1});if(m)throw m;M.value=a||[];const{data:f,error:x}=await C.from("maintenance_records").select("*").eq("car_id",D).order("maintenance_date",{ascending:!1});if(x)throw x;R.value=f||[]}catch(s){console.error("Error fetching car history:",s)}finally{E.value=!1}}const _=s=>new Intl.NumberFormat("fr-TN",{style:"currency",currency:"TND"}).format(s),l=s=>{if(!s)return null;const e=new Date(s);return e.setHours(0,0,0,0),e},j=(s,e)=>{if(!c.value&&!u.value)return!0;if(!e){const b=l(s),w=l(c.value),y=l(u.value);return!(w&&b<w||y&&b>y)}const a=l(s),m=l(e),f=l(c.value),x=l(u.value);return!(x&&a>x||f&&m<f)},h=g(()=>M.value.filter(s=>j(s.start_date,s.end_date))),T=g(()=>R.value.filter(s=>j(s.maintenance_date))),S=g(()=>!c.value&&!u.value?h.value.reduce((s,e)=>s+(e.total_price||0),0):h.value.reduce((s,e)=>{const a=l(e.start_date),m=l(e.end_date),f=1e3*60*60*24,x=Math.round((m.getTime()-a.getTime())/f),b=x>0?x:1,w=(e.total_price||0)/b,y=l(c.value)||new Date(-864e13),V=l(u.value)||new Date(864e13),I=a<y?y:a,q=m>V?V:m;if(I>q)return s;const B=Math.round((q.getTime()-I.getTime())/f)+1;if(B<=0)return s;const Y=w*B;return s+Y},0)),A=g(()=>T.value.reduce((s,e)=>s+(e.cost||0),0)),L=g(()=>S.value-A.value);return(s,e)=>!E.value&&r.value?(d(),i("div",at,[t("div",ot,[F(n(tt),{to:"/admin/history",class:"flex items-center text-sm text-gray-500 hover:text-gray-700"},{default:X(()=>[F(n(st),{class:"w-4 h-4 mr-1"}),Z(" "+o(n(p)("admin.history.back_to_list")),1)]),_:1}),t("div",rt,[t("div",nt,[e[3]||(e[3]=t("label",{class:"text-sm font-medium text-gray-700"},"Du:",-1)),H(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[U,c.value]])]),t("div",lt,[e[4]||(e[4]=t("label",{class:"text-sm font-medium text-gray-700"},"Au:",-1)),H(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[U,u.value]])]),c.value||u.value?(d(),i("button",{key:0,onClick:e[2]||(e[2]=a=>{c.value="",u.value=""}),class:"text-xs text-indigo-600 hover:text-indigo-800 font-medium"}," Réinitialiser ")):k("",!0)])]),t("div",it,[t("div",dt,[t("div",null,[t("h3",ct,o(r.value.brand)+" "+o(r.value.model),1),t("p",ut,[t("span",mt,o(r.value.license_plate),1),t("span",{class:$({"text-green-600":r.value.status==="disponible","text-blue-600":r.value.status==="loue","text-red-600":r.value.status==="maintenance"})}," ● "+o(r.value.status?n(p)(`admin.fleet.${r.value.status}`):r.value.status),3)])]),r.value.image_url?(d(),i("div",xt,[t("img",{src:r.value.image_url,alt:"",class:"h-full w-full object-cover rounded-md"},null,8,pt)])):k("",!0)]),t("div",ft,[t("div",vt,[t("div",{class:$(["text-xl font-bold",L.value>=0?"text-green-600":"text-red-600"])}," Revenu Net: "+o(_(L.value)),3)])])]),t("div",_t,[t("div",yt,[t("div",gt,[t("h3",ht,o(n(p)("admin.history.reservations_history")),1),t("div",bt," Total: "+o(_(S.value)),1)]),t("div",wt,[t("table",kt,[t("thead",Dt,[t("tr",null,[t("th",Et,o(n(p)("admin.reservations.client")),1),t("th",Tt,o(n(p)("admin.reservations.dates")),1),t("th",Ct,o(n(p)("admin.reservations.total_price")),1)])]),t("tbody",Nt,[(d(!0),i(z,null,P(h.value,a=>(d(),i("tr",{key:a.id},[t("td",Mt,o(a.client_name),1),t("td",Rt,o(n(N)(a.start_date))+" - "+o(n(N)(a.end_date)),1),t("td",jt,o(_(a.total_price)),1)]))),128)),h.value.length===0?(d(),i("tr",St,[t("td",At,o(n(p)("admin.history.no_reservations")),1)])):k("",!0)])])])]),t("div",Lt,[t("div",Vt,[e[5]||(e[5]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900"}," Historique des Coûts ",-1)),t("div",It," Total: "+o(_(A.value)),1)]),t("div",qt,[t("table",Bt,[e[7]||(e[7]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"}," Type "),t("th",{scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"}," Date "),t("th",{scope:"col",class:"px-3 py-3.5 text-right text-sm font-semibold text-gray-900"}," Coût ")])],-1)),t("tbody",Ft,[(d(!0),i(z,null,P(T.value,a=>(d(),i("tr",{key:a.id},[t("td",Ht,o(n(et)[a.maintenance_type]||a.maintenance_type),1),t("td",Ut,o(n(N)(a.maintenance_date)),1),t("td",$t,o(_(a.cost)),1)]))),128)),T.value.length===0?(d(),i("tr",zt,[...e[6]||(e[6]=[t("td",{colspan:"3",class:"px-3 py-8 text-center text-sm text-gray-500"}," Aucun entretien enregistré. ",-1)])])):k("",!0)])])])])])])):(d(),i("div",Pt,[...e[8]||(e[8]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"},null,-1)])]))}});export{Qt as default};
