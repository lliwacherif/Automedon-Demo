import{r as _,a as E,U as n}from"./index-ikd10qBV.js";function q(){const d=_([]),t=_(!1),s=_(null),f=E(()=>{const a={Renault:[],Dacia:[],Skoda:[],Hyundai:[],Seat:[],MG:[],Mahindra:[],Kia:[]};return d.value.forEach(e=>{a[e.brand]&&a[e.brand].push(e)}),a}),o=a=>({id:a.id,brand:a.brand,model:a.model,plate_number:a.license_plate,status:a.status,image_url:a.image_url,mileage:a.mileage,auto_manage_status:a.auto_manage_status,created_at:a.created_at});async function u(){t.value=!0,s.value=null;try{const{data:a,error:e}=await n.from("cars").select("id, brand, model, license_plate, status, image_url, mileage, auto_manage_status, created_at").order("brand",{ascending:!0}).order("model",{ascending:!0});if(e)throw e;const r=new Date().toISOString(),{data:i,error:l}=await n.from("reservations").select("car_id, start_date, end_date").in("status",["confirmed","active"]).gt("start_date",r).order("start_date",{ascending:!0});if(l)throw l;const w=(a||[]).map(y=>{const c=o(y),m=i?.find(b=>b.car_id===c.id);return m&&(c.next_reservation={start_date:m.start_date,end_date:m.end_date}),c});d.value=w}catch(a){s.value=a.message,console.error("Error fetching cars:",a)}finally{t.value=!1}}async function g(a){t.value=!0,s.value=null;try{const{data:e,error:r}=await n.from("cars").select("id, brand, model, license_plate, status, image_url, mileage, auto_manage_status, created_at").eq("id",a).single();if(r)throw r;return o(e)}catch(e){return s.value=e.message,console.error("Error fetching car:",e),null}finally{t.value=!1}}async function v(a){t.value=!0,s.value=null;try{const{data:e,error:r}=await n.from("cars").insert([{brand:a.brand,model:a.model,license_plate:a.plate_number,status:a.status,image_url:a.image_url||null}]).select("id, brand, model, license_plate, status, image_url, mileage, auto_manage_status, created_at").single();if(r)throw r;return await u(),o(e)}catch(e){throw s.value=e.message,console.error("Error creating car:",e),e}finally{t.value=!1}}async function p(a,e){t.value=!0,s.value=null;try{const r={};e.brand!==void 0&&(r.brand=e.brand),e.model!==void 0&&(r.model=e.model),e.plate_number!==void 0&&(r.license_plate=e.plate_number),e.status!==void 0&&(r.status=e.status),e.image_url!==void 0&&(r.image_url=e.image_url||null);const{data:i,error:l}=await n.from("cars").update(r).eq("id",a).select("id, brand, model, license_plate, status, image_url, mileage, auto_manage_status, created_at");if(l)throw l;return await u(),i?.[0]?o(i[0]):null}catch(r){throw s.value=r.message,console.error("Error updating car:",r),r}finally{t.value=!1}}async function h(a){t.value=!0,s.value=null;try{const{error:e}=await n.from("cars").delete().eq("id",a);if(e)throw e;await u()}catch(e){throw s.value=e.message,console.error("Error deleting car:",e),e}finally{t.value=!1}}return{cars:d,carsByBrand:f,loading:t,error:s,fetchCars:u,fetchCarById:g,createCar:v,updateCar:p,deleteCar:h}}export{q as u};
